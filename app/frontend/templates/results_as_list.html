<div class="row">
  <div class="col-xs-12">
    <h3 class="pull-left" style="margin-top: 11px; margin-left: 1em;">{{ results["as:totalItems"]}} documenten</h3>
    <button type="button" class="btn btn-info navbar-btn pull-right visible-xs-inline-block sidebar-collapse">
      Filters &gt;
    </button>
  </div>
</div>
{% if results.facets %}
<div class="row">
  <div class="col-xs-12 col-sm-6 col-md-4">
    <button
      class="btn-email"
      data-toggle="modal"
      data-target="#form-email-subscribe"
      {% if query %}
      data-form-email-subscribe-query="{{ query }}"
      data-form-email-subscribe-user-query="{{ query }}"
      {% elif results.facets.topics.buckets |length > 0  %}
      data-form-email-subscribe-query="{{ results.facets.topics.buckets.0.key.split()[0] |lower }}"
      data-form-email-subscribe-user-query="{{ results.facets.topics.buckets.0.key.split()[0] |lower }}"
      {% elif results.facets.location.buckets |length > 0 %}
      data-form-email-subscribe-query="{{ results.facets.location.buckets.0.key | lower }}"
      data-form-email-subscribe-user-query="{{ results.facets.location.buckets.0.key | lower }}"
      {% else %}
      data-form-email-subscribe-query="pgb"
      data-form-email-subscribe-user-query="pgb"
      {% endif %}
    >
    Krijg een email als er iets gepost wordt over
    {% if query %}
    {{ query }}
    {% elif results.facets.topics.buckets |length > 0 %}
    {{ results.facets.topics.buckets.0.key.split()[0] |lower }}
    {% elif results.facets.location.buckets |length > 0 %}
    {{ results.facets.location.buckets.0.key | lower }}
    {% else %}
    pgb
    {% endif %}
    </button>
  </div>
  <div class="col-xs-12 col-sm-6 col-md-4">
    <button
      class="btn-email"
      data-toggle="modal"
      data-target="#form-email-subscribe"
      data-form-email-subscribe-query="{% if query %}{{ query }}{% else %}*{% endif %}"
      data-form-email-subscribe-user-query="{% if query %}{{ query }}{% else %}*{% endif %}"
      {% if search_params.location %}
      data-form-email-subscribe-location="{{ search_params.location }}"
      {% elif results.facets.location.buckets |length > 0 %}
      data-form-email-subscribe-location="{{ results.facets.location.buckets.0.key | lower }}"
      {% else %}
      data-form-email-subscribe-location="{{ Amsterdam }}"
      {% endif %}
    >
    Krijg een email als er iets gepost wordt
    {% if query %}
    over {{ query }}
    {% endif %}
    {% if search_params.location %}
    in {{ search_params.location }}
    {% elif results.facets.location.buckets |length > 0 %}
    in {{ results.facets.location.buckets.0.key | lower }}
    {% else %}
    in Amsterdam
    {% endif %}
    </button>
  </div>
  <div class="col-xs-12 col-sm-6 col-md-4">
    <button
      class="btn-email"
      data-toggle="modal"
      data-target="#form-email-subscribe"
      data-form-email-subscribe-query="{% if query %}{{ query }}{% else %}*{% endif %}"
      data-form-email-subscribe-user-query="{% if query %}{{ query }}{% else %}*{% endif %}"
      {% if search_params.parties %}
      data-form-email-subscribe-parties="{{ search_params.parties }}"
      {% elif results.facets.parties.buckets |length > 0 %}
      data-form-email-subscribe-parties="{{ results.facets.parties.buckets.0.key | lower }}"
      {% else %}
      data-form-email-subscribe-parties="{{ VVD }}"
      {% endif %}
    >
    Krijg een email als er iets gepost wordt
    {% if query %}
    over {{ query }}
    {% endif %}
    en
    {% if search_params.parties %}
    {{ search_params.parties }}
    {% elif results.facets.parties.buckets |length > 0 %}
    {{ results.facets.parties.buckets.0.key | lower }}
    {% else %}
    VVD
    {% endif %}
    bevat
    </button>
  </div>
</div>
{% endif %}
{% for result in results['as:items'] %}
<div class="search-result clearfix" id="search-result-{{ result['@id'] }}">
<div class="row">
  <div class="col-md-1 hidden-xs">
    <!-- FIXME: party image -->
    <img src="/static/images/parties/{{ 'name' |as2_i18n_field(result.actor, 'nl') |party_image }}.png" alt="{{ 'name' |as2_i18n_field(result.actor, 'nl') }}" class="img-responsive">
  </div>
  <div class="col-xs-12 col-md-10">
    <h2>
      <a href="{{ result.object['@id'] }}">
        {{ 'name' |as2_i18n_field(result.object, 'nl') }}
      </a>
    </h2>
    <p class="entities">
      <!-- FIXME: party image -->
      <img src="/static/images/backdrop.png" alt="" class="img-responsive visible-xs-inline">
      <!-- FIXME: party link and name -->
      <a href="#" class="btn btn-xs btn-primary"><i class="fa fa-group"></i></a>
      <!-- FIXME: all partes in list of links below, same as above-->

      <!-- FIXME: link to location -->
      <a href="#" class="btn btn-xs btn-default"><i class="fa fa-map-marker"></i> {{ result.location }}</a>

      {% if result.created %}
      <!-- FIXME: link to permalink -->
      <a href="#" class="btn btn-xs btn-default">{{ result.created|iso8601_to_str("%d-%m-%Y %H:%M") }}</a>
      {% endif %}
      <a class="description-collapse visible-xs-inline-block pull-right" role="button" href="#description-collapse-{{ result['@id'] }}" aria-expanded="false" aria-controls="description-collapse-{{ result['@id'] }}">
        <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
      </a>
    </p>
    <div class="collapse" id="description-collapse-{{ result['@id'] }}">
      <div class="article-text">
        <!--
          {{ result |pretty_json }}
        -->

        <p>{{ "content" |as2_i18n_field(result.object, 'nl') |html_cleanup(result) |safe }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-1 hidden-xs">
    <a class="description-collapse" role="button" href="#description-collapse-{{ result['@id'] }}" aria-expanded="false" aria-controls="description-collapse-{{ result['@id'] }}">
      <span class="glyphicon glyphicon-menu-down" aria-hidden="true"></span>
    </a>
  </div>
</div>
<div class="row">
  <div class="col-xs-12">
    <p class="pull-right links">
      <a href="{{ result.object.url }}" target="_blank" class="visible-xs-block visible-sm-block visible-lg-block visible-md-block">Bron: {{ result.source }} <i class="fa fa-external-link"></i></span></a>
    </p>
  </div>
</div>
</div>
{% endfor %}

{% if results.items %}

<nav id="pager" class="text-center">
  <ul class="pagination">
    {% if page <= 1 %}
    <li class="prev previous_page disabled">
      <a href="#" rel="prev">Vorige</a>
    {% else %}
    <li class="prev previous_page">
      <a href="{{ dict(page=(page - 1)) |url_for_search_page(gov_slug) }}" rel="prev">Vorige</a>
    {% endif %}
    </li>
    {% if page >= max_pages %}
    <li class="next next_page disabled">
      <a href="#" rel="next">Volgende</a>
    {% else %}
    <li class="next next_page">
      <a href="{{ dict(page=(page + 1)) |url_for_search_page(gov_slug) }}" rel="next">Volgende</a>
    {% endif %}
    </li>
  </ul>
</nav>
{% else %}
<div class="row">
  <div class="col-xs-12">
    <p>Helaas, je we konden geen documenten vinden die voldeden aan je zoekopdracht.</p>
  </div>
</div>
{% endif %}

<script type="text/javascript">
"use strict";

{% if results['as:items'] %}
let articleObjects = {{ results['as:items'] |tojson|safe }};
{% endif %}
</script>
